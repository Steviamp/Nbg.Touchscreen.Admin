@page "/reset-password"
@rendermode InteractiveServer
@using MudBlazor
@inject NavigationManager Nav

<MudContainer MaxWidth="MaxWidth.ExtraSmall" Class="mt-10">
    <MudPaper Class="pa-6">
        <MudText Typo="Typo.h5" GutterBottom>Reset password</MudText>

        @if (_error == "token")
        {
            <MudAlert Severity="Severity.Error" Class="mb-3">
                Invalid or expired reset link.
            </MudAlert>
        }
        else if (_error == "pw")
        {
            <MudAlert Severity="Severity.Error" Class="mb-3">
                Password requirements not met or passwords do not match.
            </MudAlert>
        }

        <form method="post" action="/auth/reset-password">
            <input type="hidden" name="Token" value="@_token" />

            <MudTextField @bind-Value="_password"
                          Label="New password"
                          Name="Password"
                          InputType="InputType.Password"
                          Required="true"
                          Variant="Variant.Outlined"
                          Class="mb-3" />

            <MudTextField @bind-Value="_passwordConfirm"
                          Label="Confirm password"
                          Name="ConfirmPassword"
                          InputType="InputType.Password"
                          Required="true"
                          Variant="Variant.Outlined"
                          Class="mb-3" />

            <MudButton Variant="Variant.Filled" ButtonType="ButtonType.Submit">
                Change password
            </MudButton>
        </form>
    </MudPaper>
</MudContainer>

@code {
    private string _token = "";
    private string _password = "";
    private string _passwordConfirm = "";
    private string? _error;

    protected override void OnInitialized()
    {
        var uri = new Uri(Nav.Uri);
        var qs = System.Web.HttpUtility.ParseQueryString(uri.Query);
        _token = qs["token"] ?? "";
        _error = qs["error"];
    }
}

